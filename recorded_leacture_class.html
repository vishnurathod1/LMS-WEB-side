<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Recorded Lecture Class</title>
    <link rel="stylesheet" href="recorded_lecture.css" />
</head>
<body>
    <nav class="navbar">
        <div class="navbar-container">
            <a href="home.html" class="navbar-brand">LMS Project</a>
            <ul class="navbar-menu">
                <li class="navbar-item"><a href="home.html" class="navbar-link">Home</a></li>
                <li class="navbar-item"><a href="student_home.html" class="navbar-link">Student Home</a></li>
                <li class="navbar-item"><a href="login.html" class="navbar-link">Logout</a></li>
            </ul>
        </div>
    </nav>
    <main class="recorded-lecture-class-main">
        <h1>Recorded Lecture Class</h1>
        <div class="recorded-lecture-class-list">
            <!-- Recorded lectures will be dynamically added here -->
        </div>
    </main>
    <script>
        function getRecordedClasses() {
            const recordedClasses = localStorage.getItem('recordedClasses');
            return recordedClasses ? JSON.parse(recordedClasses) : [];
        }

        function renderRecordedClasses() {
            const recordedClasses = getRecordedClasses();
            const container = document.querySelector('.recorded-lecture-class-list');
            container.innerHTML = '';

            if (recordedClasses.length === 0) {
                container.innerHTML = '<p>No recorded classes available.</p>';
                return;
            }

            recordedClasses.forEach((recordedClass) => {
                const div = document.createElement('div');
                div.classList.add('recorded-lecture-class-item');
                div.innerHTML = `
                    <h3>${recordedClass.title}</h3>
                    <p>${recordedClass.description}</p>
                    <p><strong>Course:</strong> ${recordedClass.course}</p>
                    <p><strong>Trainer:</strong> ${recordedClass.trainer}</p>
                    <video controls width="600" src="${recordedClass.videoUrl}" data-video-url="${recordedClass.videoUrl}"></video>
                    <div class="video-error" style="display: none; color: red; margin-top: 10px;">
                        <p>⚠️ Video not available. This could be due to:</p>
                        <ul>
                            <li>Video file not found or corrupted</li>
                            <li>Network connectivity issues</li>
                            <li>Invalid video URL</li>
                        </ul>
                        <p>Video URL: ${recordedClass.videoUrl}</p>
                    </div>
                    <div class="video-controls" style="margin-top: 10px;">
                        <p><strong>Status:</strong> ${recordedClass.status}</p>
                        <button class="delete-video-btn" onclick="deleteVideo('${recordedClass.title}')" style="background-color: #dc3545; color: white; border: none; padding: 8px 16px; border-radius: 4px; cursor: pointer; margin-top: 10px;">
                            <i class="fa fa-trash"></i> Delete Video
                        </button>
                    </div>
                `;
                container.appendChild(div);
            });
        }

        // Initial render
        renderRecordedClasses();

        // Handle video loading errors for recorded classes
        function handleVideoErrors() {
            const videos = document.querySelectorAll('video[data-video-url]');
            videos.forEach(video => {
                const errorDiv = video.parentNode.querySelector('.video-error');

                video.addEventListener('error', function() {
                    console.log('Recorded video failed to load:', video.dataset.videoUrl);
                    if (errorDiv) {
                        errorDiv.style.display = 'block';
                        video.style.display = 'none';
                    }
                });

                video.addEventListener('loadstart', function() {
                    console.log('Recorded video loading started:', video.dataset.videoUrl);
                    if (errorDiv) {
                        errorDiv.style.display = 'none';
                        video.style.display = 'block';
                    }
                });
            });
        }

        // Handle video errors after rendering
        setTimeout(handleVideoErrors, 100);

        // Delete video function
        window.deleteVideo = function(title) {
            if (confirm(`Are you sure you want to delete the video "${title}"? This action cannot be undone.`)) {
                const recordedClasses = getRecordedClasses();
                const updatedClasses = recordedClasses.filter(recordedClass => recordedClass.title !== title);

                localStorage.setItem('recordedClasses', JSON.stringify(updatedClasses));

                // Re-render the list
                renderRecordedClasses();

                // Show success message
                alert(`Video "${title}" has been deleted successfully.`);

                console.log(`Video deleted: ${title}`);
    </script>
</body>
</html>
