<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Trainer Schedule</title>
    <link rel="stylesheet" href="styles.css" />
    <link rel="stylesheet" href="trainer_schedule.css" />
</head>
<body class="trainer-schedule-page">
    <main class="trainer-schedule-main">
        <h1>Trainer Schedule</h1>
        <button class="add-schedule-btn" id="add-schedule-btn">Add New Schedule</button>
        <table class="schedule-table">
            <thead>
                <tr>
                    <th>Day</th>
                    <th>Date</th>
                    <th>Trainer Name</th>
                    <th>Time</th>
                    <th>Course Name</th>
                    <th>Topics</th>
                    <th>Remarks</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
            </tbody>
        </table>
    </main>
    <script>
        function getSchedules() {
            const schedules = localStorage.getItem('trainerSchedules');
            return schedules ? JSON.parse(schedules) : [];
        }

        function saveSchedules(schedules) {
            localStorage.setItem('trainerSchedules', JSON.stringify(schedules));
        }

        function renderSchedules() {
            const schedules = getSchedules();
            const tbody = document.querySelector('.schedule-table tbody');
            tbody.innerHTML = '';
            schedules.forEach((schedule, index) => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${schedule.day}</td>
                    <td>${schedule.date}</td>
                    <td>${schedule.trainer}</td>
                    <td>${schedule.time}</td>
                    <td>${schedule.course}</td>
                    <td>${schedule.topics}</td>
                    <td>${schedule.remarks}</td>
                    <td>
                        <button class="edit-btn" data-index="${index}">Edit</button>
                        <button class="delete-btn" data-index="${index}">Delete</button>
                    </td>
                `;
                tbody.appendChild(tr);
            });
            attachEventListeners();
        }

        function attachEventListeners() {
            document.querySelectorAll('.edit-btn').forEach(button => {
                button.addEventListener('click', (e) => {
                    const index = e.target.getAttribute('data-index');
                    openEditForm(index);
                });
            });
            document.querySelectorAll('.delete-btn').forEach(button => {
                button.addEventListener('click', (e) => {
                    const index = e.target.getAttribute('data-index');
                    deleteSchedule(index);
                });
            });
        }

        function openEditForm(index) {
            const schedules = getSchedules();
            const schedule = schedules[index] || {
                day: '',
                date: '',
                trainer: '',
                time: '',
                course: '',
                topics: '',
                remarks: ''
            };
            const formHtml = `
                <div class="modal">
                    <div class="modal-content">
                        <h2>${index === undefined || index === null ? 'Add' : 'Edit'} Schedule</h2>
                        <form id="schedule-form">
                            <input type="hidden" id="schedule-index" value="${index !== undefined && index !== null ? index : ''}" />
                            <label for="day">Day:</label>
                            <input type="text" id="day" value="${schedule.day}" required />
                            <label for="date">Date:</label>
                            <input type="date" id="date" value="${formatDateForInput(schedule.date)}" required />
                            <label for="trainer">Trainer Name:</label>
                            <input type="text" id="trainer" value="${schedule.trainer}" required />
                            <label for="time">Time:</label>
                            <input type="text" id="time" value="${schedule.time}" required />
                            <label for="course">Course Name:</label>
                            <input type="text" id="course" value="${schedule.course}" required />
                            <label for="topics">Topics:</label>
                            <input type="text" id="topics" value="${schedule.topics}" required />
                            <label for="remarks">Remarks:</label>
                            <input type="text" id="remarks" value="${schedule.remarks}" />
                            <button type="submit">Save</button>
                            <button type="button" id="cancel-btn">Cancel</button>
                        </form>
                    </div>
                </div>
            `;
            document.body.insertAdjacentHTML('beforeend', formHtml);
            document.getElementById('cancel-btn').addEventListener('click', closeForm);
            document.getElementById('schedule-form').addEventListener('submit', saveSchedule);
        }

        function formatDateForInput(dateStr) {
            if (!dateStr) return '';
            const parts = dateStr.split('-');
            if(parts.length === 3) {
                return `${parts[2]}-${parts[1].padStart(2,'0')}-${parts[0].padStart(2,'0')}`;
            }
            return '';
        }

        function closeForm() {
            const modal = document.querySelector('.modal');
            if (modal) {
                modal.remove();
            }
        }

        function saveSchedule(e) {
            e.preventDefault();
            const index = document.getElementById('schedule-index').value;
            const day = document.getElementById('day').value.trim();
            const dateInput = document.getElementById('date').value;
            const date = formatDateForDisplay(dateInput);
            const trainer = document.getElementById('trainer').value.trim();
            const time = document.getElementById('time').value.trim();
            const course = document.getElementById('course').value.trim();
            const topics = document.getElementById('topics').value.trim();
            const remarks = document.getElementById('remarks').value.trim();

            if (!day || !date || !trainer || !time || !course || !topics) {
                alert('Please fill in all required fields.');
                return;
            }

            const schedules = getSchedules();
            if (index === '') {
                schedules.push({ day, date, trainer, time, course, topics, remarks });
            } else {
                schedules[index] = { day, date, trainer, time, course, topics, remarks };
            }
            saveSchedules(schedules);
            closeForm();
            renderSchedules();
        }

        function formatDateForDisplay(dateStr) {
            if (!dateStr) return '';
            const parts = dateStr.split('-');
            if(parts.length === 3) {
                return `${parts[2]}-${parts[1]}-${parts[0]}`;
            }
            return '';
        }

        function deleteSchedule(index) {
            if (confirm('Are you sure you want to delete this schedule?')) {
                const schedules = getSchedules();
                schedules.splice(index, 1);
                saveSchedules(schedules);
                renderSchedules();
            }
        }

        document.getElementById('add-schedule-btn').addEventListener('click', () => {
            openEditForm('');
        });

        // Initial render
        renderSchedules();
    </script>
</body>
</html>
